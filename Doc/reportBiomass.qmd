---
format: pdf
editor: visual
---

```{r load-libraries,echo=F,error=F,message=F,warning=F}
# Install and load pacman (library management package)
if (!require("pacman")) install.packages("pacman")

# Install and load required packages from CRAN ---------------------------------
pacman::p_load(tidyverse, lubridate, here, mapview, knitr,
               patchwork, gt)

# Install and load required packages from Github -------------------------------
# AST packages
pacman::p_load_gh("kstierhoff/surveyR")
pacman::p_load_gh("kstierhoff/atm")

# kableExtra - for R >= 4.3.0
pacman::p_load_gh("kupietz/kableExtra")

# Global knitr chunk options
knitr::opts_chunk$set(echo = F, warning = F, message = F,
                      knitr.kable.NA = "-",
                      fig.align = "center",
                      dev = "png", dev.args = list(type = "cairo"))

# Set options for NA values in knitr::kable
options(knitr.kable.NA = '-')

# Set system time zone to UTC
Sys.setenv(tz = "UTC")

# Set ggplot2 theme
theme_set(theme_bw())
```

```{r loop-controls}
# User-defined loop controls
combine.regions  <- T # Combine core and nearshore biomass plots
plot.time.series <- T # Plot biomass time series 
get.db           <- F # Query biomass estimates from AST database
save.figs        <- T
```

```{r user-input, include=FALSE}
# Get project name from directory
prj.name <- last(unlist(str_split(here(),"/")))

# Survey information files ------------------------------------------------------
settings.files <- dir(here("Doc/settings"))
prj.settings <- settings.files[str_detect(settings.files, paste0("settings_", prj.name, ".R"))]
source(here("Doc/settings", prj.settings))

# Output files ------------------------------------------------------------------
prj.output <- settings.files[str_detect(settings.files, paste0("output_", prj.name, ".R"))]
source(here("Doc/settings", prj.output))
```

```{r stock-specific-biomasses}
# Extract stock-specific data, for ease of reporting in text
## Northern Anchovy
be.anch.n <- be %>% 
  filter(Species == "Engraulis mordax", Stock == "Northern", Stratum != "All")
be.anch.c <- be %>% 
  filter(Species == "Engraulis mordax", Stock == "Central", Stratum != "All")
## Pacific Sardine
be.sar.n <- be %>% 
  filter(Species == "Sardinops sagax", Stock == "Northern", Stratum != "All")
be.sar.s <- be %>% 
  filter(Species == "Sardinops sagax", Stock == "Southern", Stratum != "All")
## Jack Mackerel
be.jack <- be %>% 
  filter(Species == "Trachurus symmetricus", Stock == "All", Stratum != "All")
## Pacific Mackerel
be.mack <- be %>% 
  filter(Species == "Scomber japonicus", Stock == "All", Stratum != "All")
## Pacific Herring
be.her <- be %>% 
  filter(Species == "Clupea pallasii", Stock == "All", Stratum != "All")
## Round Herring
be.rher <- be %>% 
  filter(Species == "Etrumeus acuminatus", Stock == "All", Stratum != "All")
```

```{r process-biomass-ts}
if (plot.time.series) {
  source(here("Code/plot_BiomassTimeSeries_2307RL.R"))
} else {
  if (file.exists(here("Output/biomass_timeseries_final.Rdata"))) {
    load(here("Output/biomass_timeseries_final.Rdata"))  
  } else {
    print("No time series data available")
  }
}
```

```{r time-series-percentages}
# Summarize percent total biomass for CS anchovy 
biomass.pct.anch.c <- biomass.spp.summ %>% 
  filter(species == "Engraulis mordax", stock == "Central")
# Summarize percent total biomass for NS anchovy
biomass.pct.anch.n <- biomass.spp.summ %>% 
  filter(species == "Engraulis mordax", stock == "Northern")
# Summarize percent total biomass for NS sardine
biomass.pct.sar.n <- biomass.spp.summ %>% 
  filter(species == "Sardinops sagax", stock == "Northern", year >= 2015)
# Summarize percent total biomass for SS sardine
biomass.pct.sar.s <- biomass.spp.summ %>% 
  filter(species == "Sardinops sagax", stock == "Southern", year >= 2015)
# Summarize percent total biomass for P. mackerel
biomass.pct.mack <- biomass.spp.summ %>% 
  filter(species == "Scomber japonicus") %>% 
  arrange(year)
# Summarize percent total biomass for Jack mackerel
biomass.pct.jack <- biomass.spp.summ %>% 
  filter(species == "Trachurus symmetricus") %>% 
  arrange(year)
# Summarize percent total biomass for P. herring
biomass.pct.her <- biomass.spp.summ %>% 
  filter(species == "Clupea pallasii") %>% 
  arrange(year)
# Summarize percent total biomass for P. herring
biomass.pct.rher <- biomass.spp.summ %>% 
  filter(species == "Etrumeus acuminatus") %>% 
  arrange(year)
```

\pagenumbering{gobble}

**DISTRIBUTION, BIOMASS, AND DEMOGRAPHICS OF COASTAL PELAGIC FISHES IN THE CALIFORNIA CURRENT ECOSYSTEM DURING SUMMER 2023 BASED ON ACOUSTIC-TRAWL SAMPLING**

Kevin L. Stierhoff^1^, Juan P. Zwolinski^1,2^, Josiah S. Renfree^1^, and David A. Demer^1,3^\text{*}

^1^Fisheries Resources Division\
Southwest Fisheries Science Center\
NOAA-National Marine Fisheries Service\
8901 La Jolla Shores Dr.\
La Jolla, CA 92037, USA

^2^University of California, Santa Cruz\
The Cooperative Institute for Marine, Earth and Atmospheric Systems (CIMEAS)\
1156 High St\
Santa Cruz, CA 95064, USA

^3^Office of Science and Technology\
NOAA-National Marine Fisheries Service\
8901 La Jolla Shores Dr.\
La Jolla, CA 92037, USA\
\text{*}current affiliation

\newpage

\tableofcontents

\newpage

\listoftables

\listoffigures

\newpage

\pagenumbering{arabic}

## Executive Summary {-}

This report provides: 1) a detailed description of the acoustic-trawl method (ATM) used by NOAA's Southwest Fisheries Science Center for direct assessments of the dominant coastal pelagic species (CPS; i.e.: Pacific Sardine *Sardinops sagax*, Northern Anchovy *Engraulis mordax*, Pacific Mackerel *Scomber japonicus*, Jack Mackerel *Trachurus symmetricus*, and Pacific Herring *Clupea pallasii* in the California Current Ecosystem off the west coast of the United States (U.S.) and sometimes portions of Canada and Baja CA, Mexico; and 2) estimates of the biomasses, distributions, and demographics of those CPS encountered in the survey area between `r survey.start` and `r survey.end` `r survey.year`.

The core survey region, which was sampled by NOAA ship *`r survey.vessel.long`* (hereafter, *`r survey.vessel`*), NOAA ship *Bell M. Shimada* (hereafter, *Shimada*), and three wind-powered uncrewed surface vehicles (Explorer USVs; Saildrone, Inc.), spanned most of the continental shelf between `r survey.landmark.n` and `r survey.landmark.s`. Planned transects were oriented approximately perpendicular to the coast, from the shallowest navigable depth (\~20 m) to a distance of 35 nmi offshore or, if farther, to the 1,000 ftm (\~1830 m) isobath. In the SCB, transects in the core region were extended to approximately 100 nmi. The survey area was initially designed to extend south to Punta Baja off Baja CA and north to Cape Scott off Vancouver Island, Canada, but was necessarily reduced due to a loss of approximately 60% of the 81 sea days allocated aboard *`r survey.vessel`*. An additional 25 sea days were allocated, and 15 days were executed, aboard *Shimada* to to sample in the core region north of Cape Mendocino where *`r survey.vessel.long`* did not sample.

Because navigation by *`r survey.vessel`*, *Shimada*, and the USVs in water shallower than \~20 m was deemed inefficient, unsafe, or both, fishing vessels *Long Beach Carnage* and *Lisa Marie* sampled CPS in the nearshore region, along 2.5 to 5 nmi-long transects spaced 5 nmi apart off the mainland coast of the U.S., between San Diego and Cape Flattery, as well as around Santa Cruz and Santa Catalina Islands in the Southern CA Bight. In the nearshore region, the species composition and CPS length distributions were estimated using catches in daytime purse-seine sets by *Long Beach Carnage* or *Lisa Marie*, whichever vessel was nearest to the acoustically sampled CPS.

The biomasses, distributions, and demographics for each species and stock are for the survey area and period, and therefore may not represent their entire population or stock. Sampling was conducted in core and nearshore regions off Baja CA by IMIPAS (formerly INAPESCA), but the estimates in this report are for U.S. waters only.

The estimated biomass of the northern stock of Northern Anchovy was `r prettyNum(be.all.summ$Biomass[be.all.summ$Species == 'Engraulis mordax' & be.all.summ$Stock == "Northern"],big.mark=",",digits=3)` t (CI~95%~ = `r prettyNum(be.all.summ$lower.ci.B[be.all.summ$Species == 'Engraulis mordax' & be.all.summ$Stock == "Northern"],big.mark=",",digits=3)` - `r prettyNum(be.all.summ$upper.ci.B[be.all.summ$Species == 'Engraulis mordax' & be.all.summ$Stock == "Northern"],big.mark=",",digits=3)` t, CV = `r prettyNum(be.all.summ$biomass.cv[be.all.summ$Species == 'Engraulis mordax' & be.all.summ$Stock == "Northern"],big.mark=",",digits=1)`%). In the core region, the biomass was `r prettyNum(be.all$Biomass[be.all$Species == 'Engraulis mordax' & be.all$Stock == "Northern"],big.mark=",",digits=4)` t (CI~95%~ = `r prettyNum(be.all$lower.ci.B[be.all$Species == 'Engraulis mordax' & be.all$Stock == "Northern"],big.mark=",",digits=4)` - `r prettyNum(be.all$upper.ci.B[be.all$Species == 'Engraulis mordax' & be.all$Stock == "Northern"],big.mark=",",digits=3)` t, CV = `r prettyNum(be.all$biomass.cv[be.all$Species == 'Engraulis mordax' & be.all$Stock == "Northern"],big.mark=",",digits=1)`%), and in the nearshore region, biomass was `r prettyNum(be.all.ns$Biomass[be.all.ns$Species == 'Engraulis mordax' & be.all.ns$Stock == "Northern"],big.mark=",",digits=3)` t (CI~95%~ = `r prettyNum(be.all.ns$lower.ci.B[be.all.ns$Species == 'Engraulis mordax' & be.all.ns$Stock == "Northern"],big.mark=",",digits=3)` - `r prettyNum(be.all.ns$upper.ci.B[be.all.ns$Species == 'Engraulis mordax' & be.all.ns$Stock == "Northern"],big.mark=",",digits=3)` t, CV = `r prettyNum(be.all.ns$biomass.cv[be.all.ns$Species == 'Engraulis mordax' & be.all.ns$Stock == "Northern"],big.mark=",",digits=1)`%), or `r prettyNum((be.all.ns$Biomass[be.all.ns$Species == 'Engraulis mordax' & be.all.ns$Stock == "Northern"] / (be.all.ns$Biomass[be.all.ns$Species == 'Engraulis mordax' & be.all.ns$Stock == "Northern"] + be.all$Biomass[be.all$Species == 'Engraulis mordax' & be.all$Stock == "Northern"]))*100,big.mark=",",digits=2)`% of the total biomass. The northern stock ranged from approximately Cape Flattery to Newport, OR, and the distribution of standard lengths ($L_S$) ranged from `r length.summ$L.min[length.summ$scientificName == 'Engraulis mordax' & length.summ$stock == "Northern"]` to `r length.summ$L.max[length.summ$scientificName == 'Engraulis mordax' & length.summ$stock == "Northern"]` cm with a mode at 13 cm in the core region and 14 cm in the nearshore region.

The estimated biomass of the central stock of Northern Anchovy was `r prettyNum(be.all.summ$Biomass[be.all.summ$Species == 'Engraulis mordax' & be.all.summ$Stock == "Central"],big.mark=",",digits=3)` t (CI~95%~ = `r prettyNum(be.all.summ$lower.ci.B[be.all.summ$Species == 'Engraulis mordax' & be.all.summ$Stock == "Central"],big.mark=",",digits=3)` - `r prettyNum(be.all.summ$upper.ci.B[be.all.summ$Species == 'Engraulis mordax' & be.all.summ$Stock == "Central"],big.mark=",",digits=3)` t, CV = `r prettyNum(be.all.summ$biomass.cv[be.all.summ$Species == 'Engraulis mordax' & be.all.summ$Stock == "Central"],big.mark=",",digits=1)`%). In the core region, the biomass was `r prettyNum(be.all$Biomass[be.all$Species == 'Engraulis mordax' & be.all$Stock == "Central"],big.mark=",",digits=4)` t (CI~95%~ = `r prettyNum(be.all$lower.ci.B[be.all$Species == 'Engraulis mordax' & be.all$Stock == "Central"],big.mark=",",digits=4)` - `r prettyNum(be.all$upper.ci.B[be.all$Species == 'Engraulis mordax' & be.all$Stock == "Central"],big.mark=",",digits=4)` t, CV = `r prettyNum(be.all$biomass.cv[be.all$Species == 'Engraulis mordax' & be.all$Stock == "Central"],big.mark=",",digits=1)`%), and in the nearshore region, the biomass was `r prettyNum(be.all.ns$Biomass[be.all.ns$Species == 'Engraulis mordax' & be.all.ns$Stock == "Central"],big.mark=",",digits=3)` t (CI~95%~ = `r prettyNum(be.all.ns$lower.ci.B[be.all.ns$Species == 'Engraulis mordax' & be.all.ns$Stock == "Central"],big.mark=",",digits=3)` - `r prettyNum(be.all.ns$upper.ci.B[be.all.ns$Species == 'Engraulis mordax' & be.all.ns$Stock == "Central"],big.mark=",",digits=3)` t, CV = `r prettyNum(be.all.ns$biomass.cv[be.all.ns$Species == 'Engraulis mordax' & be.all.ns$Stock == "Central"],big.mark=",",digits=1)`%), or `r prettyNum((be.all.ns$Biomass[be.all.ns$Species == 'Engraulis mordax' & be.all.ns$Stock == "Central"] / (be.all.ns$Biomass[be.all.ns$Species == 'Engraulis mordax' & be.all.ns$Stock == "Central"] + be.all$Biomass[be.all$Species == 'Engraulis mordax' & be.all$Stock == "Central"]))*100,big.mark=",",digits=2)`% of the total biomass. The central stock ranged from approximately Cape Mendocino to San Diego, and the distribution of $L_S$ ranged from `r length.summ$L.min[length.summ$scientificName == 'Engraulis mordax' & length.summ$stock == "Central"]` to `r length.summ$L.max[length.summ$scientificName == 'Engraulis mordax' & length.summ$stock == "Central"]` cm with a mode at 13 cm in the core region and 11 cm in the nearshore region.

The estimated biomass of the northern stock of Pacific Sardine was `r prettyNum(be.all.summ$Biomass[be.all.summ$Species == 'Sardinops sagax' & be.all.summ$Stock == "Northern"],big.mark=",",digits=3)` t (CI~95%~ = `r prettyNum(be.all.summ$lower.ci.B[be.all.summ$Species == 'Sardinops sagax' & be.all.summ$Stock == "Northern"],big.mark=",",digits=3)` - `r prettyNum(be.all.summ$upper.ci.B[be.all.summ$Species == 'Sardinops sagax' & be.all.summ$Stock == "Northern"],big.mark=",",digits=3)` t, CV = `r prettyNum(be.all.summ$biomass.cv[be.all.summ$Species == 'Sardinops sagax' & be.all.summ$Stock == "Northern"],big.mark=",",digits=1)`%), all in U.S. waters. In the core region, the biomass was `r prettyNum(be.all$Biomass[be.all$Species == 'Sardinops sagax' & be.all$Stock == "Northern"],big.mark=",",digits=3)` t (CI~95%~ = `r prettyNum(be.all$lower.ci.B[be.all$Species == 'Sardinops sagax' & be.all$Stock == "Northern"],big.mark=",",digits=3)` - `r prettyNum(be.all$upper.ci.B[be.all$Species == 'Sardinops sagax' & be.all$Stock == "Northern"],big.mark=",",digits=3)` t, CV = `r prettyNum(be.all$biomass.cv[be.all$Species == 'Sardinops sagax' & be.all$Stock == "Northern"],big.mark=",",digits=1)`%), and in the nearshore region, the biomass was `r prettyNum(be.all.ns$Biomass[be.all.ns$Species == 'Sardinops sagax' & be.all.ns$Stock == "Northern"],big.mark=",",digits=3)` t (CI~95%~ = `r prettyNum(be.all.ns$lower.ci.B[be.all.ns$Species == 'Sardinops sagax' & be.all.ns$Stock == "Northern"],big.mark=",",digits=3)` - `r prettyNum(be.all.ns$upper.ci.B[be.all.ns$Species == 'Sardinops sagax' & be.all.ns$Stock == "Northern"],big.mark=",",digits=3)` t, CV = `r prettyNum(be.all.ns$biomass.cv[be.all.ns$Species == 'Sardinops sagax' & be.all.ns$Stock == "Northern"],big.mark=",",digits=1)`%), or `r prettyNum((be.all.ns$Biomass[be.all.ns$Species == 'Sardinops sagax' & be.all.ns$Stock == "Northern"] / (be.all.ns$Biomass[be.all.ns$Species == 'Sardinops sagax' & be.all.ns$Stock == "Northern"] + be.all$Biomass[be.all$Species == 'Sardinops sagax' & be.all$Stock == "Northern"]))*100,big.mark=",",digits=2)`% of the total biomass. Within the survey area, the northern stock ranged from approximately Cape Flattery to Newport. The distribution of $L_S$ ranged from `r length.summ$L.min[length.summ$scientificName == 'Sardinops sagax' & length.summ$stock == "Northern"]` to `r length.summ$L.max[length.summ$scientificName == 'Sardinops sagax' & length.summ$stock == "Northern"]` cm with modes at 9 and 19 cm in the core region and at 19 cm in the nearshore region.

The estimated biomass of the southern stock of Pacific Sardine in the surveyed area was `r prettyNum(be.all.summ$Biomass[be.all.summ$Species == 'Sardinops sagax' & be.all.summ$Stock == "Southern"],big.mark=",",digits=4)` t (CI~95%~ = `r prettyNum(be.all.summ$lower.ci.B[be.all.summ$Species == 'Sardinops sagax' & be.all.summ$Stock == "Southern"],big.mark=",",digits=3)` - `r prettyNum(be.all.summ$upper.ci.B[be.all.summ$Species == 'Sardinops sagax' & be.all.summ$Stock == "Southern"],big.mark=",",digits=3)` t, CV = `r prettyNum(be.all.summ$biomass.cv[be.all.summ$Species == 'Sardinops sagax' & be.all.summ$Stock == "Southern"],big.mark=",",digits=1)`%). In the core region, the biomass was `r prettyNum(be.all$Biomass[be.all$Species == 'Sardinops sagax' & be.all$Stock == "Southern"],big.mark=",",digits=3)` t (CI~95%~ = `r prettyNum(be.all$lower.ci.B[be.all$Species == 'Sardinops sagax' & be.all$Stock == "Southern"],big.mark=",",digits=3)` - `r prettyNum(be.all$upper.ci.B[be.all$Species == 'Sardinops sagax' & be.all$Stock == "Southern"],big.mark=",",digits=3)` t, CV = `r prettyNum(be.all$biomass.cv[be.all$Species == 'Sardinops sagax' & be.all$Stock == "Southern"],big.mark=",",digits=1)`%), and in the nearshore region, the biomass was `r prettyNum(be.all.ns$Biomass[be.all.ns$Species == 'Sardinops sagax' & be.all.ns$Stock == "Southern"],big.mark=",",digits=3)` t (CI~95%~ = `r prettyNum(be.all.ns$lower.ci.B[be.all.ns$Species == 'Sardinops sagax' & be.all.ns$Stock == "Southern"],big.mark=",",digits=3)` - `r prettyNum(be.all.ns$upper.ci.B[be.all.ns$Species == 'Sardinops sagax' & be.all.ns$Stock == "Southern"],big.mark=",",digits=3)` t, CV = `r prettyNum(be.all.ns$biomass.cv[be.all.ns$Species == 'Sardinops sagax' & be.all.ns$Stock == "Southern"],big.mark=",",digits=1)`%), or `r prettyNum((be.all.ns$Biomass[be.all.ns$Species == 'Sardinops sagax' & be.all.ns$Stock == "Southern"] / (be.all.ns$Biomass[be.all.ns$Species == 'Sardinops sagax' & be.all.ns$Stock == "Southern"] + be.all$Biomass[be.all$Species == 'Sardinops sagax' & be.all$Stock == "Southern"]))*100,big.mark=",",digits=2)`% of the total biomass. Within the survey area, the southern stock ranged from approximately Bodega Bay to San Diego. The distribution of $L_S$ ranged from `r length.summ$L.min[length.summ$scientificName == 'Sardinops sagax' & length.summ$stock == "Southern"]` to `r length.summ$L.max[length.summ$scientificName == 'Sardinops sagax' & length.summ$stock == "Southern"]` cm with a mode at 15 cm in the core region and modes at 6 and 16 cm in the nearshore region. Notably, the survey area did not span the entire distribution of this stock, which extends south of the U.S.-Mexico border.

The estimated biomass of Pacific Mackerel was `r prettyNum(be.all.summ$Biomass[be.all.summ$Species == 'Scomber japonicus'],big.mark=",",digits=3)` t (CI~95%~ = `r prettyNum(be.all.summ$lower.ci.B[be.all.summ$Species == 'Scomber japonicus'],big.mark=",",digits=3)` - `r prettyNum(be.all.summ$upper.ci.B[be.all.summ$Species == 'Scomber japonicus'],big.mark=",",digits=3)` t, CV = `r prettyNum(be.all.summ$biomass.cv[be.all.summ$Species == 'Scomber japonicus'],big.mark=",",digits=1)`%). In the core region, the biomass was `r prettyNum(be.all$Biomass[be.all$Species == 'Scomber japonicus'],big.mark=",",digits=3)` t (CI~95%~ = `r prettyNum(be.all$lower.ci.B[be.all$Species == 'Scomber japonicus'],big.mark=",",digits=3)` - `r prettyNum(be.all$upper.ci.B[be.all$Species == 'Scomber japonicus'],big.mark=",",digits=3)` t, CV = `r prettyNum(be.all$biomass.cv[be.all$Species == 'Scomber japonicus'],big.mark=",",digits=1)`%), and in the nearshore region, the biomass was `r prettyNum(be.all.ns$Biomass[be.all.ns$Species == 'Scomber japonicus'],big.mark=",",digits=3)` t (CI~95%~ = `r prettyNum(be.all.ns$lower.ci.B[be.all.ns$Species == 'Scomber japonicus'],big.mark=",",digits=3)` - `r prettyNum(be.all.ns$upper.ci.B[be.all.ns$Species == 'Scomber japonicus'],big.mark=",",digits=3)` t, CV = `r prettyNum(be.all.ns$biomass.cv[be.all.ns$Species == 'Scomber japonicus'],big.mark=",",digits=1)`%), or `r prettyNum((be.all.ns$Biomass[be.all.ns$Species == 'Scomber japonicus'] / (be.all.ns$Biomass[be.all.ns$Species == 'Scomber japonicus'] + be.all$Biomass[be.all$Species == 'Scomber japonicus']))*100,big.mark=",",digits=3)`% of the total biomass. Pacific Mackerel were present off northern OR, around Monterey Bay, and in the SCB between Point Conception and Los Angeles. The distribution of fork lengths ($L_F$) ranged from `r length.summ$L.min[length.summ$scientificName == 'Scomber japonicus']` to `r length.summ$L.max[length.summ$scientificName == 'Scomber japonicus']` cm with modes at 12 cm in the core region and 23 cm in the nearshore region.

The estimated biomass of Jack Mackerel was `r prettyNum(be.all.summ$Biomass[be.all.summ$Species == 'Trachurus symmetricus'],big.mark=",",digits=3)` t (CI~95%~ = `r prettyNum(be.all.summ$lower.ci.B[be.all.summ$Species == 'Trachurus symmetricus'],big.mark=",",digits=3)` - `r prettyNum(be.all.summ$upper.ci.B[be.all.summ$Species == 'Trachurus symmetricus'],big.mark=",",digits=3)` t, CV = `r prettyNum(be.all.summ$biomass.cv[be.all.summ$Species == 'Trachurus symmetricus'],big.mark=",",digits=1)`%), and in the core region, biomass was `r prettyNum(be.all$Biomass[be.all$Species == 'Trachurus symmetricus'],big.mark=",",digits=4)` t (CI~95%~ = `r prettyNum(be.all$lower.ci.B[be.all$Species == 'Trachurus symmetricus'],big.mark=",",digits=3)` - `r prettyNum(be.all$upper.ci.B[be.all$Species == 'Trachurus symmetricus'],big.mark=",",digits=3)` t, CV = `r prettyNum(be.all$biomass.cv[be.all$Species == 'Trachurus symmetricus'],big.mark=",",digits=1)`%), and, in the nearshore region, biomass was `r prettyNum(be.all.ns$Biomass[be.all.ns$Species == 'Trachurus symmetricus'],big.mark=",",digits=3)` t (CI~95%~ = `r prettyNum(be.all.ns$lower.ci.B[be.all.ns$Species == 'Trachurus symmetricus'],big.mark=",",digits=3)` - `r prettyNum(be.all.ns$upper.ci.B[be.all.ns$Species == 'Trachurus symmetricus'],big.mark=",",digits=3)` t, CV = `r prettyNum(be.all.ns$biomass.cv[be.all.ns$Species == 'Trachurus symmetricus'],big.mark=",",digits=1)`%), or `r prettyNum((be.all.ns$Biomass[be.all.ns$Species == 'Trachurus symmetricus'] / (be.all.ns$Biomass[be.all.ns$Species == 'Trachurus symmetricus'] + be.all$Biomass[be.all$Species == 'Trachurus symmetricus']))*100,big.mark=",",digits=2)`% of the total biomass. Jack Mackerel were present throughout the survey area, but were most abundant between Cape Mendocino and Fort Bragg and near the northern Channel Islands in the core and nearshore regions. The distribution of $L_F$ ranged from `r length.summ$L.min[length.summ$scientificName == 'Trachurus symmetricus']` to `r length.summ$L.max[length.summ$scientificName == 'Trachurus symmetricus']` cm with modes at 10 and 50 cm in the core region. There was no clear length mode in the nearshore region.

The total estimated biomass of Pacific Herring was `r prettyNum(be.all.summ$Biomass[be.all.summ$Species == 'Clupea pallasii'],big.mark=",",digits=3)` t (CI~95%~ = `r prettyNum(be.all.summ$lower.ci.B[be.all.summ$Species == 'Clupea pallasii'],big.mark=",",digits=3)` - `r prettyNum(be.all.summ$upper.ci.B[be.all.summ$Species == 'Clupea pallasii'],big.mark=",",digits=3)` t, CV = `r prettyNum(be.all.summ$biomass.cv[be.all.summ$Species == 'Clupea pallasii'],big.mark=",",digits=1)`%). In the core region, the biomass was `r prettyNum(be.all$Biomass[be.all$Species == 'Clupea pallasii'],big.mark=",",digits=3)` t (CI~95%~ = `r prettyNum(be.all$lower.ci.B[be.all$Species == 'Clupea pallasii'],big.mark=",",digits=3)` - `r prettyNum(be.all$upper.ci.B[be.all$Species == 'Clupea pallasii'],big.mark=",",digits=3)` t, CV = `r prettyNum(be.all$biomass.cv[be.all$Species == 'Clupea pallasii'],big.mark=",",digits=1)`%). In the nearshore region, the biomass was `r prettyNum(be.all.ns$Biomass[be.all.ns$Species == 'Clupea pallasii'],big.mark=",",digits=3)` t (CI~95%~ = `r prettyNum(be.all.ns$lower.ci.B[be.all.ns$Species == 'Clupea pallasii'],big.mark=",",digits=3)` - `r prettyNum(be.all.ns$upper.ci.B[be.all.ns$Species == 'Clupea pallasii'],big.mark=",",digits=3)` t, CV = `r prettyNum(be.all.ns$biomass.cv[be.all.ns$Species == 'Clupea pallasii'],big.mark=",",digits=1)`%), or `r prettyNum((be.all.ns$Biomass[be.all.ns$Species == 'Clupea pallasii'] / (be.all.ns$Biomass[be.all.ns$Species == 'Clupea pallasii'] + be.all$Biomass[be.all$Species == 'Clupea pallasii']))*100,big.mark=",",digits=2)`% of the total biomass. Pacific Herring were distributed from approximately Cape Flattery to Cape Mendocino, but were most abundance in the core region between Cape Flattery and Newport, and in the nearshore region between Westport and Newport, and between Cape Blanco and Cape Mendocino. The distribution of $L_F$ ranged from 8 to 23 cm, with modes at 10 cm in the core region and 9 and 15 cm in the nearshore region.

The total estimated biomass of `r num2words(nrow(be.all.summ))` stocks of `r num2words(n_distinct(be.all.summ$Species))` species within the survey area was `r prettyNum(sum(be.all.summ$Biomass), big.mark=",", digits = 5)` t. Of this, `r round(be.all.summ$Biomass[be.all$Species == "Engraulis mordax" & be.all.summ$Stock == "Central"]/sum(be.all.summ$Biomass)*100)`% (`r prettyNum(be.all.summ$Biomass[be.all.summ$Species == "Engraulis mordax" & be.all.summ$Stock == "Central"], big.mark=",", digits = 5)` t) was from the central stock of Northern Anchovy. Proportions of other stocks, in decreasing order, were: Jack Mackerel (`r round(be.all.summ$Biomass[be.all.summ$Species == "Trachurus symmetricus" & be.all.summ$Stock == "All"]/sum(be.all.summ$Biomass)*100)`%), Pacific Herring (`r round(be.all.summ$Biomass[be.all.summ$Species == "Clupea pallasii" & be.all.summ$Stock == "All"]/sum(be.all.summ$Biomass)*100, 1)`%), southern stock of Pacific Sardine (`r round(be.all.summ$Biomass[be.all.summ$Species == "Sardinops sagax" & be.all.summ$Stock == "Southern"]/sum(be.all.summ$Biomass)*100)`%), northern stock of Pacific Sardine (`r round(be.all.summ$Biomass[be.all.summ$Species == "Sardinops sagax" & be.all.summ$Stock == "Northern"]/sum(be.all.summ$Biomass)*100, 1)`%), Pacific Mackerel (`r round(be.all.summ$Biomass[be.all.summ$Species == "Scomber japonicus" & be.all.summ$Stock == "All"]/sum(be.all.summ$Biomass)*100, 1)`%), and northern stock of Northern Anchovy (`r round(be.all.summ$Biomass[be.all.summ$Species == "Engraulis mordax" & be.all.summ$Stock == "Northern"]/sum(be.all.summ$Biomass)*100, 1)`%). The biomass of the central stock of Northern Anchovy, which has comprised the majority of CPS biomass since 2015, increased \~`r round((be.all.summ$Biomass[be.all.summ$Species == "Engraulis mordax" & be.all.summ$Stock == "Central"]-biomass.pct.anch.c$biomass[biomass.pct.anch.c$year == 2022])/be.all.summ$Biomass[be.all.summ$Species == "Engraulis mordax" & be.all.summ$Stock == "Central"],2)*100`% from `r prettyNum(biomass.pct.anch.c$biomass[biomass.pct.anch.c$year == 2022],big.mark=",",digits=5)` t estimated in summer 2022 [@Stierhoff2023b]. Jack Mackerel, which were found mostly south of Cape Mendocino, included age-0 fish, suggesting a recruitment. Most of the biomass attributed to the southern stock of Pacific Sardine was observed in the nearshore region.

\newpage

## Introduction {#introduction}

In the California Current Ecosystem (CCE), multiple coastal pelagic fish species (CPS; i.e.: Pacific Sardine *Sardinops sagax*, Northern Anchovy *Engraulis mordax*, Jack Mackerel *Trachurus symmetricus*, Pacific Mackerel *Scomber japonicus*, and Pacific Herring *Clupea pallasii*) comprise the bulk of the forage fish assemblage. These populations, which can change by an order of magnitude within a few years, represent important prey for marine mammals, birds, and larger migratory fishes [@Field2001], and some are targets of commercial fisheries.

During summer and fall, the northern stock of Pacific Sardine typically migrates north to feed in the productive coastal upwelling off OR, WA, and Vancouver Island [@Zwolinski2012, and references therein, **Fig.** \@ref(fig:sardine-distribution)]. In synchrony, but separately, the southern stock of Pacific Sardine migrates from Northern Baja CA, Mexico to the Southern CA Bight (SCB) [@Smith2005]. The predominantly piscivorous adult Pacific and Jack Mackerels also migrate north in summer, but go farther offshore to feed [@Zwolinski2014 and references therein]. In the winter and spring, the northern stock of Pacific Sardine typically migrates south to its spawning grounds, generally off Central and Southern CA [@Demer2012] and occasionally off OR and WA [@Lo2011]. These migrations vary in extent with population size; fish age and length; and oceanographic conditions [@Zwolinski2012]. The transition zone chlorophyll front [TZCF, @Polovina2001] may delineate the offshore and southern limit of both Pacific Sardine and Pacific Mackerel habitat [e.g., @Demer2012; @Zwolinski2012], and juveniles may have nursery areas in the SCB, downstream of upwelling regions. In contrast, Northern Anchovy spawn predominantly during winter and closer to the coast where seasonal down-welling increases retention of their eggs and larvae [@Bakun1982]. Pacific Herring spawn in intertidal beach areas [@Love1996]. The northern stock of Northern Anchovy is located off WA and OR and the central stock is located off Central and Southern CA and northern Baja CA. Whether a species migrates or remains in an area depends on its reproductive and feeding behaviors, affinity to certain oceanographic or seabed habitats, and its population size.

Acoustic-trawl method (ATM) surveys, which combine information collected with echosounders and nets, were introduced to the CCE more than 50 years ago to survey CPS off the west coast of the United States (U.S.) [@Mais1974; @Mais1977; @Smith1978]. Following a two-decade hiatus, the ATM was reintroduced in the CCE in spring 2006 to sample the then-abundant Pacific Sardine population [@Cutter2008]. Since then, this sampling effort has continued and expanded through annual or semi-annual surveys [@Zwolinski2014; @Demer2012]. Beginning in 2011, the ATM estimates of Pacific Sardine abundance, age structure, and distribution have been incorporated in the annual assessments of the northern stock [@Hill2017; @Kuriyama2020; @Kuriyama2022b]. ATM estimates are used in assessments of Pacific Mackerel [@Crone2015; @Crone2019] and the central stock of Northern Anchovy [@Kuriyama2022a]. Additionally, ATM survey results have yielded estimated abundances, demographics, and distributions of epipelagic and semi-demersal fishes [e.g., @Swartzman1997; @Williams2013; @Zwolinski2014] and zooplankton [@Hewitt2000].

This document, and references herein, describes in detail the ATM as presently used by NOAA's Southwest Fisheries Science Center (SWFSC) to survey the distributions, abundances, and demographics of CPS and their oceanographic environments [e.g., @Cutter2008; @Demer2012; @Zwolinski2014]. In general terms, the contemporary ATM combines information from satellite-sensed oceanographic conditions, multifrequency echosounders, probe-sampled oceanographic conditions, pumped samples of fish eggs, and trawl-net catches of juvenile and adult CPS. The summer survey area is initially defined with consideration to the potential habitat of the northern stock of Pacific Sardine (**Fig.** \@ref(fig:sardine-distribution)), and further expanded to encompass as much of the potential habitat as possible for other CPS present off the West Coast of the U.S. and Baja CA, as time permits.

Along transects in the survey area, multi-frequency split-beam echosounders transmit sound pulses downward beneath the ship and receive echoes from animals and the seabed in the path of the sound waves. Measurements of sound speed and absorption from conductivity-temperature-depth (CTD) probes allow accurate compensation of these echoes for propagation losses. The calibrated echo intensities, normalized to the range-dependent observational volume, provide indications of the target type and behavior [e.g., @Demer2009].

(ref:sardine-distribution) Conceptual spring (shaded region) and summer (hashed region) distributions of potential habitat for the northern stock of Pacific Sardine along the west coasts of Mexico, the United States, and Canada. The dashed and dotted lines represent, respectively, the approximate summer and spring positions of the 0.2 mg m^–3^ chlorophyll-a concentration isoline. This isoline appears to oscillate in synchrony with the transition zone chlorophyll front [TZCF, @Polovina2001] and the offshore limit of the northern stock Pacific Sardine potential habitat [@Zwolinski2011]. Mackerels are found within and on the edge of the same oceanographic habitat [e.g., @Demer2012; @Zwolinski2012]. The TZCF may delineate the offshore and southern limit of both Pacific Sardine and Pacific Mackerel distributions, and juveniles may have nursery areas in the SCB, downstream of upwelling regions.

```{r sardine-distribution,fig.cap='(ref:sardine-distribution)',out.height='7in',fig.pos='H'}
include_graphics(here("Images/img_survey_region.png"))  
```

Echoes from marine organisms are a function of their body composition, shape, and size relative to the sensing-sound wavelength, and their orientation relative to the incident sound waves [@Cutter2009; @Demer2009; @Renfree2009]. Variations in echo intensity across frequencies, known as echo spectra, indicate the taxonomic groups contributing to the echoes. The CPS, with highly reflective swim bladders, create high intensity echoes of sound pulses at all echosounder frequencies [e.g., @Conti2003]. In contrast, krill, with acoustic properties closer to those of the surrounding seawater, produce lower intensity echoes, particularly at lower frequencies [e.g., @Demer2003]. The echo energy attributed to CPS, based on empirical echo spectra [@Demer2012], are apportioned to species using trawl-catch proportions [@Zwolinski2014].

Animal densities are estimated by dividing the summed intensities attributed to a species by the length-weighted average echo intensity, i.e., the mean backscattering cross-section, from animals of that species [e.g., @Demer2012]. Transects with similar densities are grouped into post-sampling strata that mimic the natural patchiness of the target species [e.g., @Zwolinski2014]. An estimate of abundance is obtained by multiplying the average estimated density in the stratum by the stratum area [@Demer2012]. The associated sampling variance is calculated using non-parametric bootstrap of the mean transect densities. The total abundance estimate in the survey area is the sum of abundances in all strata. Similarly, the total variance estimate is the sum of the variance in each stratum.

The primary objectives of the SWFSC’s ATM surveys are to survey the distributions, abundances, and demographics of CPS, and their abiotic environments in the CCE. Typically, summer surveys are conducted during 50-90 DAS between June and October. When they occur, spring surveys are conducted during 25-40 days-at-sea (DAS) between March and May and focus primarily on the northern stock of Pacific Sardine and the central stock of Northern Anchovy. In summer, the ATM surveys also include the northern stock of Northern Anchovy and Pacific Herring. During spring and summer, biomasses are also estimated for other CPS (e.g., Pacific Mackerel, Jack Mackerel, and Round Herring) present in the survey area.

In `r tolower(survey.season)` `r survey.year`, the ATM survey, spanning the west coast of the U.S., was conducted by *`r survey.vessel`* from San Diego to Cape Mendocino, and by *Shimada* between Florence, OR and Cape Flattery. Between Pt. Conception and Cape Flattery, along adaptive transects not sampled by *`r survey.vessel`* or *Shimada*, three wind-powered uncrewed surface vessels (Explorer USVs; Saildrone, Inc.) conducted acoustic sampling. From San Diego to Cape Flattery, sampling from fishing vessels *Lisa Marie* and *Long Beach Carnage* was used to estimate the biomasses of CPS in the nearshore regions, where sampling by *`r survey.vessel`*, *Shimada*, and USVs was not possible or safe.

Presented here are: 1) a detailed description of the ATM used to survey CPS in the California Current Ecosystem (CCE) off the west coast of the U.S.; and 2) estimates of the abundances, biomasses, size structures, and distributions of CPS, specifically the northern and southern stocks of Pacific Sardine; the central and northern stocks of Northern Anchovy, Pacific Mackerel, Jack Mackerel, and Pacific Herring for the core and nearshore survey regions in which they were sampled. Additional details about the survey may be found in the survey report [@Renfree2024]. A complementary survey off Baja CA by IMIPAS used approximately the same sampling protocol. Data from that survey, including biomass estimates for CPS in those core and nearshore regions, are reported elsewhere [@Vallarta2024].

The SWFSC's survey was conducted with the approval of the Secretaria de Relaciones Exteriores (SRE, Diplomatic note UAN0995/2023), the Instituto Nacional de Estadística y Geografía (INEGI; Authorization: EG0022023, through official letter 400./91/2023), Unidad de Planeación y Coordinación Estratégica de la Secretaría de Marina (SEMAR; Letter no AI/2301/23), Unidad Coordinadora de Asuntos Internacionales (UCAI) de la Secretaría de Medio Ambiente y Recursos Naturales (SEMARNAT; Letter UCAI/01519/2023), Universidad Nacional Autónoma de México (UNAM; Letter ICML/DIR/210/2023), Unidad de Concesiones y Servicios del Instituto Federal de Telecomunicaciones (IFT; Letter IFT/223/UCS/DG-AUSE/3925/2023), and the Comisión Nacional de Acuacultura y Pesca (CONAPESCA; Permit: PPFE/DGPPE.-04052/100523).

\newpage

# Methods {#methods}

## Sampling {#methods-data-collection}

### Design {#methods-survey-design}

The `r tolower(survey.season)` `r survey.year` survey was conducted principally using *`r survey.vessel`* and *Shimada*, but was augmented with acoustic sampling by three uncrewed surface vehicles (USVs), and nearshore acoustic and purse-seine sampling by two fishing vessels, *Long Beach Carnage* and *Lisa Marie*. The sampling domain between `r survey.landmark.n` and `r survey.landmark.s`, was defined by the conceptual distribution of potential habitat for the northern stock of Pacific Sardine in summer (**Fig.** \@ref(fig:sardine-distribution)), but also encompassed an unknown portion of the anticipated distributions of the southern stock of Pacific Sardine and the central and northern stocks of Northern Anchovy off the west coasts of the U.S. It also spanned portions of the Pacific Mackerel, Jack Mackerel, and Pacific Herring populations. East to west, the sampling domain extended from the coast to at least the 1,000 ftm (\~1830 m) isobath (**Fig.** \@ref(fig:survey-plan)). Considering the expected distribution of the target species, the acceptable uncertainty in biomass estimates, and the available ship time (`r survey.das` days at sea, DAS), the principal survey objectives were to estimate the biomasses of the northern and southern stocks of Pacific Sardine and the northern and central stocks of Northern Anchovy, whose expected distributions were encompassed by the planned survey region. Secondary objectives were to estimate the population biomasses of Pacific Mackerel, Jack Mackerel, Pacific Herring, and Round Herring within the area sampled, since their expected distributions extend beyond the planned survey region.

The core region transects were perpendicular to the coast, extending from the shallowest navigable depth (\~20 m) to either a distance of 35 nmi or, where farther, to the 1,000 ftm isobath (**Fig.** \@ref(fig:survey-plan)). Compulsory transects were spaced 10 nmi apart in areas of historic CPS abundance (e.g., between Cape Flattery and Cape Mendocino) and 20 nmi apart elsewhere. When CPS were observed within the westernmost 3 nmi of a transect, that transect and the next one to the north were extended in 5-nmi increments until no CPS were observed in the last 3 nmi of the extension, to a maximum extension of 50 nmi. In most years, transects are sampled in a north-to-south direction. In `r tolower(survey.season)` `r survey.year`, transects were sampled south-to-north to coordinate sampling with the Northwest Fisheries Science Center's hake survey conducted aboard *Shimada*.

The `r survey.das` DAS aboard *`r survey.vessel`* were divided among three survey legs, and mid-leg personnel transfers were planned to exchange scientists, resulting in six shorter legs (Legs I.1 and I.2; II.1 and II.2; and III.1 and III.2) between each scheduled port call. Leg I.1 and all of Leg II on *`r survey.vessel`* were canceled due to staffing and mechanical issues aboard the ship, prompting modifications to the sampling plan. For example, all transects off Baja CA and Vancouver Island were canceled, and Leg I.2 sampling began off San Diego, CA. Compulsory transect spacing was changed to 20 nmi throughout the survey area, and the three USVs (SD-1048, SD-1060, and SD-1096) were directed to sample groups of five adaptive interstitial transects spaced 20-nmi apart using a "leapfrog approach" between Pt. Conception and Cape Flattery (cyan lines, **Fig.** \@ref(fig:survey-plan)). However, due to delays and lost sea days, the time between acoustic sampling from USVs and trawl sampling from *`r survey.vessel`* and *Shimada* was often greater than 30 d, so CPS backscatter measured from USVs was not used to estimate biomass. Nine days were lost during Leg III due to mechanical issues and weather. To mitigate the loss of sea days aboard *`r survey.vessel`*, additional sampling was conducted aboard *Shimada* during Leg IV (19 DAS), which sampled the core region between Florence, OR and Cape Flattery.

To estimate the abundances and biomasses of CPS between Cape Flattery and San Diego, in the nearshore region where *`r survey.vessel`*, *Shimada*, and the USVs could not efficiently or safely navigate or trawl, two fishing vessels conducted acoustic and purse-seine sampling (magenta lines, **Fig.** \@ref(fig:survey-plan)). *Long Beach Carnage* sampled to \~5-m depth along 5-nmi-long transects spaced 5 nmi apart between San Diego and Bodega Bay, and 2.5-nmi-long transects spaced 2.5 nmi apart around Santa Cruz and Santa Catalina Islands in the SCB. *Lisa Marie* sampled transects to \~5-m depth, spaced 5 nmi apart between Bodega Bay and Cape Flattery (**Fig.** \@ref(fig:survey-plan)). Off OR and WA, *Lisa Marie* conducted exploratory acoustic and purse-seine sampling beyond the 5-nmi nearshore region, but those data were excluded prior to estimating biomasses to avoid double-counting of biomass estimated by *Shimada* in the core region.

(ref:survey-plan) Planned compulsory transects sampled by NOAA Ships *`r survey.vessel`* and *Shimada* (black lines); adaptive transects to be sampled by FSVs when target CPS are present (dashed red lines); interstitial transects sampled by USVs (cyan lines); and nearshore transects sampled by *Lisa Marie* and *Long Beach Carnage* (magenta lines). White points indicate planned UCTD stations. Isobaths (light gray lines) are 50, 200, 500, and 2,000 m.

```{r survey-plan,fig.cap='(ref:survey-plan)',out.height='8in',fig.pos='H'}
include_graphics(here("Figs/fig_survey_map.png"))  
```

### Acoustic {#methods-acoustic-sampling}

#### Acoustic equipment {#methods-acoustic-equipment}

##### *`r survey.vessel`*

Multi-frequency Wide-Bandwidth Transceivers (`r echo.freqs.dash[survey.vessel.primary]`kHz Simrad EK80 WBTs; Kongsberg) were configured with split-beam transducers (Simrad `r echo.models[survey.vessel.primary]`, respectively; Kongsberg). The transducers were mounted on the bottom of a retractable keel or "centerboard" (**Fig.** \@ref(fig:cb-config)). The keel was retracted (transducers at \~`r cb.retracted`-m depth) during calibration, and extended to the intermediate position (transducers at \~`r cb.intermediate`-m depth) during the survey. Exceptions were made during shallow water operations, when the keel was retracted; or during times of heavy weather, when the keel was extended (transducers at \~`r cb.extended`-m depth) to provide extra stability and reduce the effect of weather-generated noise. In addition, acoustic data were also collected using a multibeam echosounder (Simrad ME70; Kongsberg), multibeam sonar (Simrad MS70; Kongsberg), scanning sonar (Simrad SX90; Kongsberg), acoustic Doppler current profiler and echosounder (Simrad EC150-3C, Kongsberg), and a separate ADCP (Ocean Surveyor OS75; Teledyne RD Instruments). Transducer position and motion were measured at 5 Hz using an inertial motion unit (Applanix POS-MV; Trimble).

##### *Shimada*

Multi-frequency Wide-Bandwidth Transceivers (`r echo.freqs.dash["SH"]`kHz Simrad EK80 WBTs; Kongsberg) were configured with split-beam transducers (Simrad `r echo.models["SH"]`, respectively; Kongsberg). The transducers were mounted on the bottom of a retractable keel or "centerboard" (**Fig.** \@ref(fig:cb-config-sh)). The keel was retracted (transducers at \~`r cb.retracted`-m depth) during calibration, and extended to the intermediate position (transducers at \~`r cb.intermediate`-m depth) during the survey. Exceptions were made during shallow water operations, when the keel was retracted; or during times of heavy weather, when the keel was extended (transducers at \~`r cb.extended`-m depth) to provide extra stability and reduce the effect of weather-generated noise. In addition, acoustic data were also collected using a multibeam echosounder (Simrad ME70; Kongsberg) and a separate ADCP (Ocean Surveyor OS75; Teledyne RD Instruments). Transducer position and motion were measured at 5 Hz using an inertial motion unit (Applanix POS-MV; Trimble).

##### *Lisa Marie*

On *Lisa Marie*, multi-frequency Wideband Transceivers (Simrad `r echo.freqs.dash["LM"]`kHz Simrad EK80 WBTs; Kongsberg) were connected to the vessel's hull-mounted split-beam transducers (Simrad `r echo.models["LM"]`; Kongsberg). The transducers were at a water depth of \~4 m.

##### *Long Beach Carnage*

On *Long Beach Carnage*, the SWFSC's multi-frequency General Purpose Transceivers (`r echo.freqs.dash["LBC"]`kHz Simrad EK60 GPTs; Kongsberg) were configured with the SWFSC's split-beam transducers (Simrad `r echo.models["LBC"]`; Kongsberg) mounted in a multi-frequency transducer array (MTA4) on the bottom of a retractable pole (**Fig.** \@ref(fig:cb-config-lbc)). The transducers were at a water depth of roughly 2 m.

##### USVs

On the three USVs (SD-1048, SD-1060, and SD-1096), miniature Wide-Bandwidth Transceivers (Simrad WBT-Mini; Kongsberg) were configured with gimbaled, keel-mounted, dual-frequency transducers (Simrad `r echo.models["SD"]`; Kongsberg) containing a split-beam 38-kHz transducer and single-beam 200-kHz transducer with nominally 18$^\circ$ beamwidths. The transducers were at a water depth of \~1.9 m.

\newpage

(ref:cb-config) Echosounder transducers mounted on the bottom of the retractable centerboard on *`r survey.vessel`*. During the survey, the centerboard was extended, typically positioning the transducers \~2 m below the keel at a water depth of \~7 m.

```{r cb-config,fig.cap='(ref:cb-config)',out.width='6in',fig.pos='H'}
if (survey.vessel.primary == "RL") {
  include_graphics(here("Images/img_centerboard_config_RL.png"))
} else if (survey.vessel.primary == "SH") {
  include_graphics(here("Images/img_centerboard_config_SH.png"))
}
```

(ref:cb-config-sh) Echosounder transducers mounted on the bottom of the retractable centerboard on *Shimada*. During the survey, the centerboard was extended, typically positioning the transducers \~2 m below the keel at a water depth of \~7 m.

```{r cb-config-sh,fig.cap='(ref:cb-config-sh)',out.width='7in',fig.pos='H'}
include_graphics(here("Images/img_centerboard_config_SH.png"))
```

\newpage

(ref:cb-config-lbc) Transducers (Top-bottom: Simrad ES200-7C, ES120-7C, ES38-12, and ES70-7C, Kongsberg) in a pole-mounted multi-transducer array (MTA4) installed on *Long Beach Carnage*.

```{r cb-config-lbc,fig.cap='(ref:cb-config-lbc)',out.height = '4in',fig.align='center',fig.pos='H'}
include_graphics(here("Images/img_carnage_mta4.jpg"))
```

\newpage

```{r cal-results-other, eval=FALSE}
# Source calibration results from other vessels\
source(here("Code", paste0("processCal_", prj.name, ".R")))
```

#### Echosounder calibrations {#methods-echosounder-calibration}

##### *`r survey.vessel`*

The echosounder systems aboard *`r survey.vessel`* were calibrated on `r cal.datetime` while the vessel was docked at `r cal.loc` (`r cal.lat.dd` $^{\circ}\textrm{N}$, `r cal.lon.dd` $^{\circ}\textrm{W}$) using the standard sphere technique [@Foote1987; @Demer2015]. Each WBT was calibrated in both CW (i.e., continuous wave or narrowband mode) and FM mode (i.e., frequency modulation or broadband mode). The reference target was a `r cal.sphere`; for FM mode, additional calibrations were conducted for the 120, 200, and 333-kHz echosounders using a 25-mm WC sphere (WC25). Prior to the calibrations, temperature and salinity were measured to a depth of 10 m using a handheld probe (Pro2030, YSI) to estimate sound speeds at the transducer and sphere depths, and the time-averaged sound speed and absorption coefficients for the range between them. The theoretical target strength ($TS$; dB re 1 m^2^) of the sphere was calculated using values for the sphere, sound-pulse, and seawater properties. The sphere was positioned throughout the main lobe of each of the transducer beams using three motorized downriggers, two on one side of the vessel and one on the other. The WBTs were configured using the calibration results via the control software (Simrad EK80 `r ek80.version`; Kongsberg; **Table** \@ref(tab:cal-results)). Calibration results for WBTs in FM mode are presented in the survey report [@Renfree2024].

```{r process-cal}
# Currently, the process-cal-all section must be run first to either extract all
# calibration results from a SQL database or load it from an .Rdata file. This
# section then pulls out the results for the current survey then formats it into
# a data frame for displaying the results. This is then done separately for each
# survey vessel. This should be updated so that it loops through each survey
# vessel, obtains the calibration info, then formats it for displaying in a
# table

# Cycle through each vessel
for (i in cal.vessels) {
  
  # Define directory with calibration files for current vessel
  cal.dir <- paste(here("Data/Calibration"), i, sep = '/')
  
  # Get list of calibration files for that vessel
  cal.files <- sort(list.files(cal.dir, pattern = ".xml", 
                               full.names = TRUE))
  
  # Initialize data frames for storing results
  cal.res   <- data.frame()
  cal.info  <- data.frame()
  cal.pings <- data.frame()
  
  # Cycle through each calibration file (frequency)
  for (j in cal.files) {
  
    # Extract calibration info for that frequency
    cal <- extract_cal(j)
    
    # Append to data frames
    cal.res <- bind_rows(cal.res,   cal$cal.res)
    cal.info <- bind_rows(cal.info,  cal$cal.info)
    cal.pings <- bind_rows(cal.pings, cal$cal.pings)
  }
  
  # Now read calibration results from ECS file
  cal.ECS <- list.files(cal.dir, pattern = ".ecs$", 
                        full.names = TRUE) %>%
    atm::extract_cal_ecs()
  
  # create data frame of important echosounder parameters
  cal.params <- cal.res %>% 
    select(txdr_freq,  # Transducer frequency
           txdr_type,  # Transducer model
           txdr_sn,    # Transducer serial number
           gpt_power,  # Transmit power
           gpt_pd)     # Pulse duration

  # Specify names for echosounder parameters 
  names(cal.params) <- c("Frequency",
                         "Model",
                         "Serial Number",
                         "Transmit Power ($p_\\mathrm{et}$)",
                         "Pulse Duration ($\\tau$)")


  # create data frame of beam model results
  bm.res <- select(cal.ECS,
                   Temperature,
                   Salinity,
                   SoundSpeed,
                   Frequency, 
                   Gain, 
                   Sa_correction, 
                   Beamwidth_alongship, 
                   Beamwidth_athwartship,
                   OffsetAngle_alongship, 
                   OffsetAngle_athwartship,
                   TwoWayBeamAngle)
  
  # Specify number of significant digits for certain parameters
  bm.res$Temperature <- formatC(bm.res$Temperature, format="f", digits=1)
  bm.res$Salinity <- formatC(bm.res$Salinity, format="f", digits=1)
  bm.res$SoundSpeed <- formatC(bm.res$SoundSpeed, format="f", digits=1)
  bm.res$Frequency <- formatC(bm.res$Frequency, format="d", digits=0)
  bm.res$Gain <- formatC(bm.res$Gain, format="f", digits=2)
  bm.res$Sa_correction <- formatC(bm.res$Sa_correction, format="f", digits=2)
  bm.res$Beamwidth_alongship <- formatC(bm.res$Beamwidth_alongship, format="f", digits=2)
  bm.res$Beamwidth_athwartship <- formatC(bm.res$Beamwidth_athwartship, format="f", digits=2)
  bm.res$OffsetAngle_alongship <- formatC(bm.res$OffsetAngle_alongship, format="f", digits=2)
  bm.res$OffsetAngle_athwartship <- formatC(bm.res$OffsetAngle_athwartship, format="f", digits=2)
  bm.res$TwoWayBeamAngle <- formatC(bm.res$TwoWayBeamAngle, format="f", digits=2)

  # Specify names for beam model results
  names(bm.res) <- c("Temperature",
                     "Salinity",
                     "Sound speed",
                     "Frequency",
                     "On-axis Gain ($G_0$)",
                     "$S_\\mathrm{a}$ Correction ($S_\\mathrm{a}\\mathrm{corr}$)",
                     "3-dB Beamwidth Along. ($\\alpha_\\mathrm{-3dB}$)",
                     "3-dB Beamwidth Athw. ($\\beta_\\mathrm{-3dB}$)",
                     "Angle Offset Along. ($\\alpha_{0}$)",
                     "Angle Offset Athw. ($\\beta_{0}$)",
                     "Equivalent Two-way Beam Angle ($\\Psi$)")
  
  # Sort data frames by frequency
  param.output <- cal.params %>% 
    pivot_longer(-Frequency, names_to = "variable", values_to = "value", values_transform = as.character) %>% 
    pivot_wider(names_from = Frequency, values_from = value)
  
  bm.output <- bm.res %>% 
    pivot_longer(-Frequency, names_to = "variable", values_to = "value", values_transform = as.character) %>% 
    pivot_wider(names_from = Frequency, values_from = value)

  # Create column defining parameter units
  param.units <- data.frame(Units = c(" ",                 # Model number
                                      " ",                 # Serial number
                                      "W",                 # Transmit power
                                      "ms"))               # Pulse duration
                                      
  # Create column defining beam model units
  bm.units <- data.frame(Units = c("C",                    # Temperature
                                   "ppt",                  # Salinity
                                   "m s$^{-1}$",               # Sound speed
                                   "dB re 1",              # Transducer gain
                                   "dB re 1",              # Sa correction factor
                                   "deg",                  # Alongship beamwidth
                                   "deg",                  # Athwartship beamwidth
                                   "deg",                  # Alongship offset angle
                                   "deg",                  # Athwartship offset angle
                                   "dB re 1 sr"))          # Equivalent two-way beam angle

  # Add units column to parameter data frame
  param.output <- bind_cols(param.output, param.units) %>% 
    select(variable, Units, everything()) %>% 
    rename("Frequency ($f$, kHz)" = variable)

  # Add units column to beam model results data frame
  bm.output <- bind_cols(bm.output, bm.units) %>% 
    select(variable, Units, everything()) %>% 
    rename("Frequency ($f$, kHz)" = variable)

  # combine the parameters and results data frames
  all.output <- rbind(param.output, bm.output) %>% 
    rename(" " = "Frequency ($f$, kHz)")
  
  # Store in data frame specific to the current vessel
  assign(paste("all.output.", i, sep = ""), all.output)

  # save output to .Rdata and CSV
  save(all.output,
       file = here(paste("Output/cal_output_table_", i, ".Rdata", sep = '')))

  write.csv(all.output,
            file = here(paste("Output/cal_output_table_", i, ".csv", sep = '')),
            quote = F, row.names = F)

  # If saving figures, then plot and save calibration polar plots
  if (save.figs) {
  
    # Format ping data for plotting
    cal.pings <- cal.pings %>% 
      mutate(cal_date = date(date_time)) %>% 
      filter(between(cal_date,
                     ymd(cal.plot.date) - days(cal.window),
                     ymd(cal.plot.date) + days(cal.window))) %>% 
      arrange(txdr_freq, ping_num)
  
    # Set axis limits based on range of ping angles
    cal.lim.tmp <- round(max(max(cal.pings$along), max(cal.pings$athw))) 
  
    if (cal.lim.tmp %% 2) {
      # If range is odd, add 1 to make axis ticks look nice
      cal.axis.lims <- c(-(cal.lim.tmp + 1), cal.lim.tmp + 1)
    } else {
      cal.axis.lims <- c(-cal.lim.tmp, cal.lim.tmp)
    }
  
    # subset only outlier points
    outliers <- filter(cal.pings, outlier == 1)
  
    cal.pings <- cal.pings %>% 
      left_join(select(cal.res,txdr_freq,txdr_type,target_ts,
                       txdr_gain,bm_txdr_gain,
                       bm_alon_ba,bm_athw_ba,
                       bm_alon_oa,bm_athw_oa)) %>% 
      mutate(
        txdr_type      = fct_reorder(txdr_type, txdr_freq),
        TS_u_new       = TS_u + 2*(txdr_gain - bm_txdr_gain),
        alpha          = along - bm_alon_oa,
        beta           = athw - bm_athw_oa,
        x              = (2*alpha) / bm_alon_ba,
        y              = (2*beta) / bm_athw_ba,
        B              = 6.0206*(x^2 + y^2 - 0.18*x^2*y^2),
        TS_c_new       = TS_u_new + B,
        relTS_c        = TS_c_new - target_ts,
        relTS_c_scaled = case_when(
          relTS_c >= 1 ~ 1,
          relTS_c <= -1 ~-1,
          between(relTS_c,-1,1) ~ relTS_c))
    
    if (cal.scales == "fixed") {
      # Plot beam-uncompensated target strength data #####
      tsu.scatter <- ggplot(filter(cal.pings, outlier == 0), aes(athw, along)) +
        geom_point(aes(colour = TS_u)) + 
        geom_point(data = filter(cal.pings, outlier == 1), aes(athw, along), 
                   shape = "+", size = 1, alpha = 0.7) +
        facet_wrap(~txdr_type, scales = cal.scales) +
        scale_colour_viridis_c(name = expression(paste(italic(TS)[u]," (dB)",sep = "")),
                             option = "magma") +
        scale_x_continuous('\nAthwartship Beam Angle (deg)',limits = cal.axis.lims,
                           breaks = seq(min(cal.axis.lims), max(cal.axis.lims), 2)) +
        scale_y_continuous('Alongship Beam Angle (deg)\n',limits = cal.axis.lims,
                           breaks = seq(min(cal.axis.lims), max(cal.axis.lims), 2)) +
        guides(size =  "none") + theme_bw() + 
        theme(panel.spacing    = unit(1, "lines"),
              strip.background = element_rect(fill = "white"),
              strip.text.x     = element_text(face = "bold")) + 
        coord_equal()
      
      # Plot beam-compensated target strength data #####
      tsc.scatter <- ggplot(filter(cal.pings, outlier == 0), aes(athw, along)) +
        geom_point(aes(fill = relTS_c_scaled), shape = 21) + 
        geom_point(data = filter(cal.pings, outlier == 1), aes(athw, along),
                   shape = "+", size = 4) +
        facet_wrap(~txdr_type, scales = cal.scales) + 
        scale_fill_distiller(name = expression(italic(TS)[rel]),
                             type = "div", palette = "RdBu", limits = c(-1,1)) +
        scale_x_continuous('\nAthwartship Beam Angle (deg)', limits = cal.axis.lims,
                           breaks = seq(min(cal.axis.lims), max(cal.axis.lims), 2)) +
        scale_y_continuous('Alongship Beam Angle (deg)\n',limits = cal.axis.lims,
                           breaks = seq(min(cal.axis.lims), max(cal.axis.lims), 2)) +
        theme_bw() + 
        theme(panel.spacing = unit(1, "lines"),
              strip.background = element_rect(fill = "white"),
              strip.text.x = element_text(face = "bold")) +
        coord_equal()
      
    } else {
      # Plot beam-uncompensated target strength data #####
      tsu.scatter <- ggplot(filter(cal.pings, outlier == 0), aes(athw, along)) +
        geom_point(aes(colour = TS_u)) + 
        geom_point(data = filter(cal.pings, outlier == 1), aes(athw, along), 
                   shape = "+", size = 1, alpha = 0.7) +
        facet_wrap(~txdr_type, scales = cal.scales) +
        scale_colour_viridis_c(name = expression(paste(italic(TS)[u]," (dB)",sep = "")),
                             option = "magma") +
        scale_x_continuous('\nAthwartship Beam Angle (deg)') +
        scale_y_continuous('Alongship Beam Angle (deg)\n') +
        guides(size =  "none") + theme_bw() + 
        theme(panel.spacing    = unit(1, "lines"),
              strip.background = element_rect(fill = "white"),
              strip.text.x     = element_text(face = "bold")) 
      
      # Plot beam-compensated target strength data #####
      tsc.scatter <- ggplot(filter(cal.pings, outlier == 0), aes(athw, along)) +
        geom_point(aes(fill = relTS_c_scaled), shape = 21, colour = "gray70") + 
        geom_point(data = filter(cal.pings, outlier == 1), aes(athw, along),
                   shape = "+", size = 4) +
        facet_wrap(~txdr_type, scales = cal.scales) + 
        scale_fill_distiller(name = expression(italic(TS)[rel]),
                             type = "div", palette = "RdBu", limits = c(-1,1)) +
        scale_x_continuous('\nAthwartship Beam Angle (deg)') +
        scale_y_continuous('Alongship Beam Angle (deg)\n') +
        theme_bw() + 
        theme(panel.spacing = unit(1, "lines"),
              strip.background = element_rect(fill = "white"),
              strip.text.x = element_text(face = "bold")) 
    }
    
    # Define figure widths based on vessel so that plots are relatively square
    fig.width <- switch(i,
                        "RL" = 10,
                        "LM" = 11.5,
                        "LBC" = 7,
                        "SH"  = 10)
    
    # Save TS_c plot 
    ggsave(tsu.scatter, filename = here(paste("Figs/fig_cal_TSu_scatter_", i, ".png", sep = '')),  
           width = fig.width, height = 6)
    
    # Save TS_c plot 
    ggsave(here(paste("Figs/fig_cal_TSrel_scatter_", i, ".png", sep = '')), tsc.scatter,
           width = fig.width, height = 6)
  }
}
```

```{r process-cal-saildrone}

# Create a column with beam model units
bm.units.sd <- data.frame(Units = c("",                 # Echosounder serial #
                                    "",                 # Transducer serial #
                                    "C",                # Temperature
                                    "ppt",              # Salinity
                                    "m s$^{-1}$",       # Sound speed
                                    "dB re 1 sr",       # Equivalent two-way beam angle
                                    "dB re 1",          # Gain
                                    "dB re 1",          # Sa_correction
                                    "deg",              # Alongship beamwidth
                                    "deg",              # Athwartship beamwidth
                                    "deg",              # Alongship offset angle
                                    "deg",              # Athwartship offset angle
                                    "dB"))              # RMS

all.output.sd <- tibble::tribble(
  ~" ", ~"1048 (38)", ~"1048 (200)", ~"1060 (38)", ~"1060 (200)", ~"1096 (38)", ~"1096 (200)",
  "Echosounder SN", "264028", "264028", "719362", "719362", "268636", "268636",
  "Transducer SN", "126", "126", "131", "131", "136", "136",
  "Temperature", "15.9", "15.9", "17.4", "17.4", "18.4", "18.4",
  "Salinity", "21.9", "21.9", "23.9", "23.9", "23.3", "23.3",
  "Sound speed", "1494.3", "1494.3", "1501.4", "1501.4", "1503.6", "1503.6",
  "Eq. Two-way Beam Angle ($\\mathrm{\\Psi}$)",                 "-12.4", "-11.2", "-12.6", "-12.0", "-12.5", "-11.5",
  "On-axis Gain ($G_0$)",                                        "19.10", "19.45", "19.04", "19.44", "18.96", "19.50",
  "$S_\\mathrm{a}$ Correction ($S_\\mathrm{a}\\mathrm{corr}$)",  "0.04", "0.00", "-0.04", "-0.05", "0.03", "0.12",
  "3-dB Beamwidth Along. ($\\alpha_\\mathrm{-3dB}$)",            "18.3", "20.6", "17.8", "19.8", "18.1", "20.3",
  "3-dB Beamwidth Athw. ($\\beta_\\mathrm{-3dB}$)",              "18.2", "21.5", "17.8", "18.6", "18.2", "20.4",
  "Angle Offset Along. ($\\alpha_{0}$)",                         "0.3", "0.2", "0.2", "0.5", "0.0", "0.6",
  "Angle Offset Athw. ($\\beta_{0}$)",                           "0.1", "-0.1", "-0.6", "-0.3", "-0.4", "0.1",
  "RMS",                                                         "0.21", "0.50", "0.16", "0.44", "0.20", "0.42"
) %>% 
  bind_cols(bm.units.sd) %>% 
  select(1, Units, everything())

# save output to .Rdata and CSV
save(all.output.sd,
     file = here("Output/cal_output_table_Saildrone.Rdata"))

write.csv(all.output.sd,
          file = here("Output/cal_output_table_Saildrone.csv"), 
          quote = F, row.names = F)
```

(ref:cal-results) Wide-Bandwidth Transceiver (Simrad EK80 WBT; Kongsberg) information, pre-calibration settings, and post-calibration beam model results (below the horizontal line). Prior to the survey, on-axis gain ($G_0$), beam angles, angle offsets, and $S_A$ Correction ($S_\mathrm{A}\mathrm{corr}$) values from calibration results were entered into the WBT control software (Simrad EK80; Kongsberg).

```{r cal-results, results='asis'}
# Copy calibration results
cal.results <- all.output.RL # %>% 
  # Remove unwanted lines
  # slice(-5:-8, -10:-18)

# Get number of columns for table formatting
cal.cols <- ncol(cal.results)

# print LaTeX table for HTML or PDF
kable(cal.results, 
      # format = knitr.format, 
      align = c("l","l",rep("c", cal.cols - 2)),
      booktabs = TRUE, linesep = "", escape = FALSE,
      caption = '(ref:cal-results)') %>% 
  kable_styling(position = "center", latex_options = c("scale_down","hold_position")) %>%
  add_header_above(c(" " = 2, "Frequency (kHz)" = cal.cols - 2)) %>% 
  row_spec(7, hline_after = TRUE)
```

```{r cal-results-gt}

```

\newpage

##### *Shimada*

The echosounder systems aboard *Shimada* were calibrated by the NWFSC on 9 September after completing the Integrated Ecosystem and Pacific Hake Acoustic-Trawl Survey. The calibration was conducted using the standard sphere technique [@Foote1987; @Demer2015] while the vessel was on anchor near Seattle, WA. Each WBT was calibrated in CW (i.e., continuous wave or narrowband mode) mode. The reference target was a `r cal.sphere`. Prior to the calibrations, temperature and salinity were measured to a depth of 10 m using a handheld probe (Pro2030, YSI) to estimate sound speeds at the transducer and sphere depths, and the time-averaged sound speed and absorption coefficients for the range between them. The theoretical target strength ($TS$; dB re 1 m^2^) of the sphere was calculated using values for the sphere, sound-pulse, and seawater properties. The sphere was positioned throughout the main lobe of each of the transducer beams using three motorized downriggers, two on one side of the vessel and one on the other. The WBTs were configured using the calibration results via the control software (Simrad EK80; Kongsberg; **Table** \@ref(tab:cal-results-sh)).

(ref:cal-results-sh) Wideband Transceiver (Simrad EK80 WBT; Kongsberg) and transducer information (above horizontal line) and beam model results (below horizontal line) estimated from calibration of the echosounders aboard *Shimada* using a WC38.1 standard sphere.

```{r cal-results-sh,results='asis'}
# print LaTeX table for HTML or PDF
kable(all.output.SH, 
      # format = knitr.format, 
      align = c("l","l", rep("c",ncol(all.output.SH) - 2)),
      booktabs = TRUE, escape = FALSE, linesep = "",
      caption = '(ref:cal-results-sh)') %>% 
  kable_styling(position = "center", 
                latex_options = c("hold_position"),
                font_size = 8) %>%  
  row_spec(7, hline_after = TRUE) %>% 
  add_header_above(c(" " = 2, "Frequency (kHz)" = ncol(all.output.SH) - 2))
```

\newpage

##### *Lisa Marie*

The WBTs aboard *Lisa Marie* were calibrated on 12 June using the standard sphere technique [@Foote1987; @Demer2015], while the vessel was anchored in Gig Harbor, WA (47.32212 N, 122.57275 W). Calibration results for *Lisa Marie* are presented in **Table** \@ref(tab:cal-results-lm).

(ref:cal-results-lm) Wideband Transceiver (Simrad EK80 WBT; Kongsberg) and transducer information (above horizontal line) and beam model results (below horizontal line) estimated from calibration of the echosounders aboard *Lisa Marie* using a WC38.1 standard sphere.

```{r cal-results-lm,results='asis'}
# print LaTeX table for HTML or PDF
kable(all.output.LM, 
      # format = knitr.format, 
      align = c("l","l", rep("c",ncol(all.output.LM) - 2)),
      booktabs = TRUE, escape = FALSE, linesep = "",
      caption = '(ref:cal-results-lm)') %>% 
  kable_styling(position = "center", 
                latex_options = c("hold_position"),
                font_size = 8) %>%  
  row_spec(7, hline_after = TRUE) %>% 
  add_header_above(c(" " = 2, "Frequency (kHz)" = ncol(all.output.LM) - 2))
```

##### *Long Beach Carnage*

The GPTs aboard *Long Beach Carnage* were calibrated on 18 April, using the standard sphere technique [@Foote1987; @Demer2015], in a tank at the SWFSC [@Demer2015]. Calibration results for *Long Beach Carnage* are presented in **Table** \@ref(tab:cal-results-lbc).

(ref:cal-results-lbc) General Purpose Transceiver (Simrad EK60 GPT; Kongsberg) and transducer information (above horizontal line) and beam model results (below horizontal line) estimated from a tank calibration, using a WC38.1 standard sphere, of the echosounders later installed and used aboard *Long Beach Carnage*.

```{r cal-results-lbc,results='asis'}
# print LaTeX table for HTML or PDF
kable(all.output.LBC, 
      # format = knitr.format, 
      align = c("l","l", rep("c",ncol(all.output.LBC) - 2)),
      booktabs = TRUE, escape = FALSE, linesep = "",
      caption = '(ref:cal-results-lbc)') %>% 
  kable_styling(position = "center", 
                latex_options = c("hold_position"),
                font_size = 8) %>%  
  row_spec(7, hline_after = TRUE) %>% 
  add_header_above(c(" " = 2, "Frequency (kHz)" = ncol(all.output.LBC) - 2))
```

\newpage

##### USVs

The WBTs for the three USVs were calibrated dockside by Saildrone, Inc. using the standard sphere technique [@Foote1987; @Demer2015]. The results, processed and derived by the SWFSC using the method described in Renfree et al. [-@Renfree2019], are presented in **Table** \@ref(tab:cal-results-sd).

(ref:cal-results-sd) Miniature Wideband Transceiver (Simrad-Kongsberg WBT Mini) beam model results estimated from calibrations of echosounders using a WC38.1 standard sphere, of the echosounders aboard the three USVs.

```{r cal-results-sd,results='asis'}
# print LaTeX table for HTML or PDF
kable(all.output.sd, 
      # format = knitr.format, 
      align = c("l","l", rep("c",ncol(all.output.sd) - 2)),
      booktabs = T, escape = F, linesep = "",
      caption = '(ref:cal-results-sd)') %>% 
  kable_styling(position = "center", 
                latex_options = c("hold_position"),
                font_size = 8) %>% 
  row_spec(5, hline_after = T) %>%
  # add_header_above(c(" " = 2, "1045" = 2, "1046" = 2, "1047" = 2)) %>% 
  add_header_above(c(" " = 2, "Saildrone (Frequency)" = 6))
```

#### Data collection {#methods-acoustic-data-collection}

On *`r survey.vessel`* and *Shimada*, the computer clocks were synchronized with the GPS clock (UTC) using synchronization software (NetTime[^1]). The 18-kHz WBTs, operated by a separate PC from the other echosounders, were programmed to track the seabed and output the detected depth to the ship’s Scientific Computing System (SCS). The echosounders were controlled by the EK80 Adaptive Logger \[EAL[^2], @Renfree2016\]. The EAL optimizes the pulse interval based on the seabed depth, while avoiding aliased seabed echoes, and was programmed such that once an hour the echosounders would record three pings in passive mode, for obtaining estimates of the background noise level. Acoustic sampling for CPS-density estimation along the pre-determined transects was limited to daylight hours (approximately between sunrise and sunset).

[^1]: http://timesynctool.com

[^2]: https://www.fisheries.noaa.gov/west-coast/science-data/ek80-adaptive-logger/

During daytime aboard *`r survey.vessel`* and *Shimada*, measurements of volume backscattering strength ($S_v$; dB re 1 m^2^ m^-3^) and target strength ($TS$; dB re 1 m^2^), indexed by time and geographic positions provided by GPS receivers, were logged to 60 m beyond the detected seabed range or to a maximum range of 500, 500, 500, 300, and 150 m for 38, 70, 120, 200, and 333 kHz, respectively, and stored, with a `r raw.size`-GB maximum file size, in Simrad-EK80 .raw format. At nighttime, echosounders were set to FM mode to improve target strength estimation and species differentiation for CPS in the depths sampled by the surface trawls, and logged to 100 m to reduce data volume. For each acoustic instrument, the prefix for the file names is a concatenation of the survey name (e.g., `r survey.name`), the operational mode (CW or FM), and the logging commencement date and time from the EK80 software. For example, file generated by the EK80 software (`r ek80.version`) for a WBT operated in CW mode is named `2307RL-CW-D20230801-T125901.raw`.

To minimize acoustic interference, transmit pulses from all echosounders and sonars (e.g., EK80, ME70, MS70, SX90, EC150-3C, and ADCP) were triggered using a synchronization system (Simrad K-Sync; Kongsberg). The K-Sync trigger rate, and thus echosounder ping interval, was modulated by the EAL using the seabed depth measured using the 18-kHz echosounder. During daytime, the ME70, MS70 (*`r survey.vessel`* only), and SX90 (*`r survey.vessel`* only) were operated continuously, but only recorded at the discretion of the acoustician during times when CPS were present. During daytime, the ADCP was operated and data were recorded continuously. All other instruments that produce sound within the echosounder bandwidths were secured during daytime survey operations. Exceptions were made during stations (e.g., plankton sampling and fish trawling) or in shallow water when the vessel's command occasionally operated the bridge's 50- and 200-kHz echosounders (Furuno), the Doppler velocity log (SRD-500A; Sperry Marine), or both. At nighttime, only the EK80 and EC-150 were operated. Analyses of data from the ADCP, EC-150, ME70, MS70, and SX90 are not presented in this report.

On *Lisa Marie* and *Long Beach Carnage*, the EAL was used to control the EK80 software to modulate the echosounder recording ranges and ping intervals to avoid aliased seabed echoes. When the EAL was not utilized, the EK80 data was recorded to 1000 m and the software was set to use the maximum ping rate. Transmit pulses from the echosounders and fishing sonars were not synchronized. Therefore, the latter was secured during daytime acoustic transects.

On the USVs, the echosounders were programmed to transmit CW pulses during daytime, and the data were logged to different ranges, dependent on the seabed depth. For deeper seabed depths, the ping interval was 2 s and the 38 and 200-kHz echosounders recorded to 1000 and 400 m, respectively. For shallower depths, the ping interval was 1 s and both echosounders recorded to 250 m. Once an hour, the echosounders operated in passive mode and recorded data from three pings to obtain estimates of the background noise levels. At night, the echosounders were programmed to transmit FM pulses and record backscatter to 100-m range.

### Oceanographic {#methods-oceanographic-sampling}

#### Conductivity and temperature versus depth (CTD) {#methods-ctd-sampling}

Conductivity and temperature were measured versus depth to `r ctd.cast.depth` m (or to within \~10 m of the seabed if shallower than `r ctd.cast.depth` m) with calibrated sensors on a CTD rosette (Model SBE911+, Seabird) or underway probe [UnderwayCTD (UCTD); Oceanscience] cast from the vessel. One to three casts were planned along each acoustic transect (**Fig.** \@ref(fig:survey-plan)). These data were used to calculate the harmonic mean sound speed [@Demer2015] for estimating ranges to the sound scatterers, and frequency-specific sound absorption coefficients for compensating signal attenuation of the sound pulse between the transducer and scatterers [@Simmonds2005] (see **Section** \@ref(methods-sound-calcs)).

#### Scientific Computer System {#methods-scs-sampling}

While underway, information about the position and direction (e.g., latitude, longitude, speed, course over ground, and heading), weather (air temperature, humidity, wind speed and direction, and barometric pressure), and sea-surface oceanography (e.g., temperature, salinity, and fluorescence) were measured continuously and logged using the ship's Scientific Computer System (SCS). The data from a subset of these sensors, logged with a standardized format at 1-min resolution, are available on NOAA's ERDDAP data server[^3] [^4].

[^3]: `r paste0(erddap.url, erddap.vessel,".html")`

[^4]: http://coastwatch.pfeg.noaa.gov/erddap/tabledap/fsuNoaaShipWTEDnrt.html

### Fish-eggs {#methods-cufes-sampling}

On *`r survey.vessel`*, fish eggs were sampled during the day using a continuous underway fish egg sampler [CUFES, @Checkley1997], which collects water and plankton at a rate of \~640 l min^-1^ from an intake at \~3-m depth on the hull of the ship. The particles in the sampled water were sieved by a 505-$\mu$m mesh. Pacific Sardine, Northern Anchovy, Jack Mackerel, and Pacific Hake (*Merluccius productus*) eggs were identified to species, counted, and logged. Eggs from other species (e.g., Pacific Mackerel and flatfishes) were also counted and logged as "other fish eggs." Typically, the duration of each CUFES sample was 30 min, corresponding to a distance of 5 nmi at a speed of 10 kn. Because the durations of the early egg stages are short (i.e., less than 3 d) for most fish species, the egg distributions inferred from CUFES indicated the presence of actively spawning fish, and were used in combination with CPS echoes to select trawl locations.

### Species and Demographics {#methods-trawl-sampling}

The net catches provide information about species composition, lengths, weights and ages of CPS sampled acoustically during the day. Nighttime trawls conducted from FSVs sampled fish dispersed in the upper \~15 m of the sea surface. After sunset, schools of CPS and other fish tend to ascend and disperse and are less likely to avoid a trawl net [@Mais1977]. Beginning in the summer of 2023, and when weather conditions were favorable, the trawl net was towed along an arced path so that the net fished outside of the ship's wake [@Nottestad2015]. Daytime purse-seine nets were set nearshore by participating fishing vessels to sample CPS schools where their depth is constrained by the seabed and their vision is obscured by turbidity due to primary production and suspended particulates.

#### Trawl gear {#methods-trawl-gear}

Aboard *`r survey.vessel`* and *Shimada*, a Nordic 264 rope trawl (NET Systems, Bainbridge Island, WA; **Figs.** \@ref(fig:trawl-diagram)**a,b**), was towed at the surface for 45 min at a speed of 3.5-4.5 kn. The net has a rectangular opening with an area of approximately 300 m^2^ (\~15-m tall x 20-m wide), a throat with variable-sized mesh and a "marine mammal excluder device" to prevent the capture of large animals, such as dolphins, turtles, or sharks while retaining target species [@Dotson2010], and an 8-mm square-mesh cod-end liner (to retain a large range of animal sizes). The trawl doors were foam-filled and the trawl headrope was lined with floats so the trawl towed at the surface. Temperature-depth recorders (TDRs; RBRduet^3^ T.D., RBR) were attached to the kite and footrope to evaluate trawl performance (**Fig.** \@ref(fig:tdr-example)).

#### Purse-seine gear {#methods-seine-sampling}

*Lisa Marie* used an approximately 440-m-long and 40-m-deep purse-seine net with 17-mm-wide mesh (A. Blair, pers. comm.). *Long Beach Carnage* used an approximately 200-m-long and 27-m-deep purse-seine net with 17-mm-wide mesh; a small section on the back end of the net had 25-mm-wide mesh (R. Ashley, pers. comm.). Specimens collected by *Lisa Marie* were processed aboard the vessel by the WA Department of Fish and Wildlife (WDFW; see see **Section** \@ref(methods-seine-processing-lm)) and specimens collected aboard *Long Beach Carnage* were processed ashore by the CA Department of Fish and Wildlife (CDFW; see **Section** \@ref(methods-seine-processing-lbc))).

(ref:trawl-diagram) Schematics of the Nordic 264 rope trawl a) net and b) cod-end.

```{r trawl-diagram, fig.cap='(ref:trawl-diagram)',out.height='6.5in',fig.pos='H'}
include_graphics(here("Images/img_Nordic_264.png")) 
```

\newpage

(ref:tdr-example) Example depths (m) of the trawl headrope (red line) and footrope (blue line) measured using temperature-depth recorders (TDRs) during the net deployment (dashed box) and when actively fishing (shaded region). The vessel speed over ground (kn, black line) was measured using the ship's GPS.

```{r tdr-example, fig.cap='(ref:tdr-example)',out.width='6.5in',fig.align='center',fig.pos='H'}
include_graphics(here("Images/img_TDR_example.png")) 
```
