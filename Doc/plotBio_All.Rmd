---
title: "Acoustic backscatter, CUFES Egg Density, and Trawl Species Proportions for the 2019 California Current Ecosystem Survey (1907RL)"
author: "SWFSC Advanced Survey Technologies Group"
date: 'Last updated: `r format(Sys.time(), "%F %T", tz = "America/Los_Angeles", usetz = TRUE)`'
output:
  bookdown::html_document2:
    toc: yes
    toc_float: yes
css: css/ast.css
---

```{r setup,echo=F,message=F,warning=F,error=F,include=F}
# Install and load pacman (library management package)
if (!require("pacman")) install.packages("pacman")

# Install and load required packages from CRAN ---------------------------------
pacman::p_load(tidyverse, here, knitr, DT, fs, htmltools)

# global knitr chunk options
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```  

# Interactive survey map

(ref:interactive-map) An interactive map of the distribution of 38-kHz integrated backscattering coefficients ($s_A$, m^2^ nmi^-2^;  averaged over 2000-m distance intervals) ascribed to CPS (from 5 to 70-m deep) and krill (5 to 350-m deep); CUFES egg density (eggs m^-3^) for anchovy, sardine, and jack mackerel; catch (by weight) of CPS species in trawl clusters (the combination of up to three trawl hauls conducted within a 12 h period; white points); and some other miscellaneous survey data. Hover-over or click on some map objects for more info.

```{r plot-leaflet-map-child, child='../Output/imap/imap_widget.html',out.height="8in",out.width="100%",eval=FALSE}

```

```{r plot-leaflet-map, fig.cap='(ref:interactive-map)',out.width="100%",eval=FALSE}
# # Load imap
# load(here("Output/imap/plotBio_explorer.Rdata"))
# 
# # Display map
# i.map
```

# Acoustic backscatter
## CPS

(ref:backscatter-map-cps) The distribution of 38-kHz integrated backscattering coefficients ($s_A$, m^2^ nmi^-2^;  averaged over 2000-m distance intervals and from 5 to 70-m deep) ascribed to CPS.

```{r plot-backscatter-cps,fig.cap='(ref:backscatter-map-cps)',out.width="100%"}
include_graphics(here("Figs/fig_backscatter_cps.png"))
```

\newpage

## Krill

(ref:backscatter-map-krill) The distribution of 200-kHz integrated backscattering coefficients ($s_A$, m^2^ nmi^-2^;  averaged over 2000-m distance intervals and from 5 to 350-m deep) ascribed to krill.

```{r plot-backscatter-krill,fig.cap='(ref:backscatter-map-krill)',out.width="100%"}
include_graphics(here("Figs/fig_backscatter_krill.png"))
```

\newpage  

# CUFES Egg Density

(ref:cufes-egg-density) Map of CUFES egg density (eggs m^-3^) for anchovy, jack mackerel, and sardine.

```{r plot-cufes,fig.cap='(ref:cufes-egg-density)',out.width="100%"}
include_graphics(here("Figs/fig_cufes_egg_density.png"))
```  

\newpage

(ref:cufes-egg-density-facet) Map of CUFES egg density (eggs m^-3^) for anchovy, jack mackerel, and sardine.

```{r plot-cufes-facet,fig.cap='(ref:cufes-egg-density-facet)',out.width='100%'}
include_graphics(here("Figs/fig_cufes_egg_density_facet.png"))
```

\newpage  

**Table 1.** Bad CUFES samples

```{r bad-cufes-table}
# Load bad CUFES data
load(here("Output/cufes_bad.Rdata"))

if (nrow(cufes.bad) > 0) {
  datatable(cufes.bad)
} else {
  print("No bad cufes samples.")
}
```


\newpage

# Trawl species proportions  

(ref:trawl-proportion-haul-wt) Proportions of CPS species in trawl hauls, by weight (black points indicate trawl hauls with no CPS). 

```{r plot-trawl-proportion-haul-wt,fig.cap='(ref:trawl-proportion-haul-wt)',out.width='100%'}
include_graphics(here("Figs/fig_trawl_proportion_haul_wt.png"))
```

\newpage  

# Backscatter, CUFES egg density, and trawl species proportions  

(ref:nasc-cufes-trawl) A map of the a) distribution of 38-kHz integrated backscattering coefficients ($s_A$, m^2^ nmi^-2^;  averaged over 2000-m distance intervals and from 5 to 70-m deep) ascribed to CPS, b) CUFES egg density (eggs m^-3^) for anchovy and sardine, and c) proportions of CPS species (by weight) in trawl hauls (black points indicate trawl hauls with no CPS).

```{r plot-combo-maps,fig.cap='(ref:nasc-cufes-trawl)',out.width='100%'}
include_graphics(here("Figs/fig_nasc_cufes_haul_wt.png"))
```

# Plot saildrone data

(ref:saildrone-transects) Transect sampled by Saildrone unmanned survace vehicles (USVs).

```{r plot-saildrone,fig.cap='(ref:saildrone-transects)',out.width='100%',eval=FALSE}
include_graphics(here("Figs/fig_saildrone_map.png"))
```

# Examine backscatter outliers 

(ref:nasc-outliers) An interactive plot of the top 100 backscatter ($s_A$) intervals, labeled with the transect name and interval to facilitate futher scrutiny of processing steps in Echoview.

```{r plot-big-nasc,fig.cap='(ref:nasc-outliers)'}
# Load NASC outliers
load(here("Output/nasc_backscatter_plotly.Rdata"))

# Plot NASC outliers using plotly
plotly::ggplotly(nasc.outlier.plotly)
```  

For questions about these data, please contact Kevin Stierhoff ([kevin.stierhoff@noaa.gov](mailto:kevin.stierhoff@noaa.gov)).
